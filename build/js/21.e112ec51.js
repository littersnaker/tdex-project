webpackJsonp([21],{110:function(e,t,a){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function s(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var c=a(0),l=a.n(c),o=a(24),i=a(9),u=(a(25),a(27)),h=(a(18),a(15)),d=a(26),m=a(5),f=a(147),p=a(130),v=(a(132),a(16)),g=a(2),y=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),E=function e(t,a,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,a);if(void 0===r){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,a,n)}if("value"in r)return r.value;var c=r.get;if(void 0!==c)return c.call(n)},b=function(e){function t(e){n(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.query=0,a.CoinsMap={},a.Products={},a.accountTab=v.a.WALLET.TYPE.SPOT,a.state={accountTab:v.a.WALLET.TYPE.SPOT,Codes:"",balance:null,actNum:0,showPro:!1,errData:[""],refreshLog:!1,showLog:!1},a}return s(t,e),y(t,[{key:"componentWillUnmount",value:function(){E(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"componentWillUnmount",this).call(this)}},{key:"setAccoutnTab",value:function(e){this.accountTab=e,this.setState({accountTab:e})}},{key:"queryHandle",value:function(){var e=this.props.location.query,t=e.currency,a=e.tab;this.query&&(this.query=t),a&&this.setAccoutnTab(a)}},{key:"componentWillMount",value:function(){this.queryHandle(),this.loadCodesList()}},{key:"loadCodesList",value:function(){var e=u.a.getProductCoins(),t=this;e?this.saveProducts(e):u.a.loadProductCoins(null,function(e){e&&t.saveProducts(e.List)},this)}},{key:"filterProducts",value:function(e){var t=this.accountTab,a=t===v.a.WALLET.TYPE.FUT?1:2;if(e){var n=[];for(var r in e)e[r].Types&a&&n.push(e[r]);return n}}},{key:"saveProducts",value:function(e){if(this.CoinsMap=e,this.Products=this.filterProducts(e),this.Products&&this.Products.length){var t=this.Products[0];this.query?t=this.setProduct(this.query):this.setProduct(t.Id),this.getWalletBalance(t.Id)}}},{key:"setProduct",value:function(e){var t={};for(var a in this.Products){if(e==this.Products[a].Id){t=this.Products[a];break}}return this.setState({Codes:t}),t}},{key:"getWalletBalance",value:function(e,t){var a=this,n={Currency:Number(e),Type:t?Number(t):Number(this.accountTab)};i.a.httpRequest("wallet/balance",n,function(e){if(0==e.Status&&e.Data){var t=e.Data;a.setState({balance:t,showPro:!1})}else a.setState({balance:null})},this)}},{key:"swapProducts",value:function(){var e=this.accountTab==v.a.WALLET.TYPE.SPOT?v.a.WALLET.TYPE.FUT:v.a.WALLET.TYPE.SPOT;if(this.setAccoutnTab(e),this.resetData(),this.Products=this.filterProducts(this.CoinsMap),this.Products){var t=this.Products[0].Id;this.changeProduct(t),this.getWalletBalance(t,e)}}},{key:"resetData",value:function(){var e={errData:[""],actNum:0};this.refs.tfNum.value="",this.setState(e)}},{key:"changeProduct",value:function(e){if(!e||e==this.state.Codes.Id)return!1;this.setProduct(e),this.getWalletBalance(e),this.resetData()}},{key:"closeProduct",value:function(e){e.stopPropagation(),this.state.showPro&&this.setState({showPro:!1})}},{key:"resetError",value:function(){this.setState({errData:[""]})}},{key:"checkMoney",value:function(){var e=this.state,t=e.balance,a=e.errData,n=0,r="",s=this.walletCounts(t),c=this.refs.tfNum.value,l=Number(c);return c?isNaN(l)?(n=3,r=g.a.lang("Withdrawals.correct_input")):!l||l<1e-4?(n=3,r=g.a.lang("Transfer.error.min","0.0001")):l>s.canUse?(n=3,r=g.a.lang("Withdrawals.error.maxWith")):/^(-?\d+)(\.\d{1,4})?$/.test(l)||(n=3,r=g.a.lang("Withdrawals.error.maxFloat",4)):(n=3,r=g.a.lang("form.error.empty")),a[0]=r,this.setState({errData:a}),n}},{key:"checkHadEmpty",value:function(){return!!this.checkMoney()||(this.resetError(),!1)}},{key:"handleSubmit",value:function(e){return e.stopPropagation(),e.preventDefault(),this.state.Codes?!this.checkHadEmpty()&&void this.popVerify():(Object(m.g)(g.a.lang("common.not_open"),!0),!1)}},{key:"popVerify",value:function(){var e=this,t=this.state,a=t.Codes,n=t.actNum,r=n+" "+a.Code;d.a.open(l.a.createElement(f.a,{title:g.a.lang("WalletTransfer.theme"),content:g.a.lang("WalletTransfer.confirm",r),callback:function(){return e.walletWithdraw()}}),"alert_panel")}},{key:"popCallback",value:function(e){if("close"==e)return void d.a.close();this.walletWithdraw(e)}},{key:"walletWithdraw",value:function(){var e=this.state,t=e.Codes,a=e.accountTab,n=e.refreshLog,r={};r.Currency=Number(t.Id),r.Direction=Number(a),r.Amount=Number(this.refs.tfNum.value);var s=this;i.a.httpRequest("wallet/switch",r,function(e){if(0==e.Status){d.a.close();var t=e.Data;s.setState({balance:t,refreshLog:!n}),Object(m.g)(g.a.lang("Exchange.success"))}},this)}},{key:"setMaxWith",value:function(e,t){t.stopPropagation(),this.refs.tfNum.value=Number(e),this.setState({actNum:Number(e)})}},{key:"setFeeNum",value:function(){this.state.Codes&&(this.checkMoney()||this.getActual())}},{key:"getActual",value:function(){var e=Number(this.refs.tfNum.value);if(!e)return!1;this.setState({actNum:e})}},{key:"walletCounts",value:function(e){var t=0,a=0,n=0;return e&&(a=Number(h.a.accAdd(e.Lock,h.a.accAdd(h.a.accAdd(e.Transfer,e.Deposit),e.Withdraw))),t=Number(h.a.accAdd(a,h.a.accSubtr(e.Quantity,e.Unconfirm))),n=t>0?Number(h.a.accAdd(e.Lock,e.Quantity)):0),{Counts:t,Freeze:a,canUse:n}}},{key:"toggleProduct",value:function(e){e.stopPropagation(),this.setState({showPro:!this.state.showPro})}},{key:"showLog",value:function(e){this.setState({showLog:e})}},{key:"render",value:function(){var e=this,t=this.state,a=t.accountTab,n=t.balance,r=t.Codes,s=t.errData,c=t.refreshLog,o=t.showLog,i=t.showPro,u="0.0000",d="0.0000",m="";if(r&&(m=r.Code),n){var f=this.walletCounts(n);u=h.a.format(f.Counts,4).toString(),d=h.a.format(f.canUse,4).toString()}return l.a.createElement("div",{className:"inside-page-web",onClick:function(t){return e.closeProduct(t)}},l.a.createElement("div",{className:"inside-web-part"},l.a.createElement("div",{className:"withdrawal"},l.a.createElement("div",{className:"w-head-top m-head-top",onClick:this.resetData.bind(this)},l.a.createElement("h3",{onClick:function(){return e.showLog(!1)},className:"fl "+(o?"m-under-l":"")},g.a.lang("WalletTransfer.theme")),l.a.createElement("h3",{onClick:function(){return e.showLog(!0)},className:"pc-hide fr "+(o?"":"m-under-l")},g.a.lang("Recharge.log"))),l.a.createElement("div",{className:0==o?"currency_left transfer-box":"currency_left transfer-box m-hide"},l.a.createElement("div",{className:"exchange-info"},l.a.createElement("dl",{className:"wp-33"},l.a.createElement("dt",null,l.a.createElement("div",{className:"select pdl-20"},a==v.a.WALLET.TYPE.SPOT?g.a.lang("Asset.bit"):g.a.lang("Asset.contract")))),l.a.createElement("div",{className:"wp-33 md-text"},l.a.createElement("span",{className:"swap-btn",onClick:this.swapProducts.bind(this)},l.a.createElement("i",{className:"iconfont icon-change tb"}))),l.a.createElement("dl",{className:"wp-33"},l.a.createElement("dt",null,l.a.createElement("div",{className:"select pdl-20"},a==v.a.WALLET.TYPE.FUT?g.a.lang("Asset.bit"):g.a.lang("Asset.contract"))))),l.a.createElement("div",{className:"pos-r"},l.a.createElement("h5",{className:"lh-32"},g.a.lang("Asset.105")),l.a.createElement("div",{className:"select",onClick:function(t){return e.toggleProduct(t)}},l.a.createElement("div",{className:"currency_pic"}),l.a.createElement("div",{className:"currency_text"},l.a.createElement("h4",null,m)),l.a.createElement("div",{className:"triangle"},l.a.createElement("i",{className:0==i?"iconfont icon-dropDown c-8":"iconfont icon-dropUp c-8"}))),i&&l.a.createElement("div",{className:"select_option wp-100",style:{top:70}},l.a.createElement("ul",null,this.Products&&this.Products.map(function(t,a){return l.a.createElement("li",{key:a,onClick:function(){return e.changeProduct(t.Id)}},l.a.createElement("div",{className:"currency_pic"}),l.a.createElement("div",{className:"currency_text"},l.a.createElement("h4",null,t.Code)))}),!this.Products.length&&l.a.createElement("li",{className:"tc"},l.a.createElement("div",{className:"currency_text c-8"},l.a.createElement("h4",null,g.a.lang("ico.noData"))))))),l.a.createElement("form",{className:"mt-20",onSubmit:function(t){e.handleSubmit(t)},autoComplete:"off"},l.a.createElement("div",{className:"input_box2"},l.a.createElement("h5",{className:"lh-32"},g.a.lang("WalletTransfer.amounts")),l.a.createElement("div",{className:"address f-clear"},l.a.createElement("div",{className:"ipt ipt-box pos-r "+(s[0]?"bd-err":"")},l.a.createElement("input",{type:"text",ref:"tfNum",onChange:function(){return e.setFeeNum()},placeholder:g.a.lang("tradeInfo.2_25"),maxLength:"15"}),l.a.createElement("div",{className:"withUse",onClick:function(t){return e.setMaxWith(d,t)}},g.a.lang("Withdrawals.103"),l.a.createElement("span",null,d))),l.a.createElement("div",{className:"ipt-box unit-bdl-none transfer-all",onClick:function(t){return e.setMaxWith(d,t)}},g.a.lang("WalletTransfer.all"))),""!=s[0]&&l.a.createElement("div",{className:"red2 fem75 mt-5"},s[0])),l.a.createElement("div",{className:"input_box3"},l.a.createElement("button",{type:"submit",className:"mt-20 btn "+(u>0?"":"btnDis")},g.a.lang("WalletTransfer.transfer"))))),l.a.createElement("div",{className:1==!o?"m-hide":"transfer-log-box"},l.a.createElement(P,{product:r,coinsMap:this.CoinsMap,refresh:c})))))}}]),t}(o.a);t.default=b;var P=function(e){function t(e){n(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.CoinsMap=null,a.product=null,a.refresh=!1,a.state={curPage:1,historyList:{List:[],PageSize:10}},a}return s(t,e),y(t,[{key:"componentWillMount",value:function(){}},{key:"getHistory",value:function(e){var t=e||this.state.curPage,a=this.product.Id;if(!a)return!1;var n=this;i.a.httpRequest("wallet/orders",{Type:8,Currency:Number(a),Page:t,PageSize:10},function(e){if(0==e.Status){var t=e.Data;n.setState({historyList:t,curPage:t.Page})}},this)}},{key:"resetCoinsMap",value:function(e){var t={};e.forEach(function(e){t[e.Id]=e}),this.CoinsMap=t}},{key:"componentWillReceiveProps",value:function(e){var t=e.refresh;this.product||(this.product=e.product,this.resetCoinsMap(e.coinsMap),this.getHistory()),this.refresh!=t&&(this.product=e.product,this.refresh=t,this.getHistory())}},{key:"turnPage",value:function(e){this.getHistory(e)}},{key:"getProductName",value:function(e){if(this.CoinsMap)return this.CoinsMap[e].Code}},{key:"render",value:function(){var e=this.state.historyList,t=this;return l.a.createElement("div",{className:"record_right pos-r"},l.a.createElement("div",{className:"historical"},l.a.createElement("h4",null,g.a.lang("Recharge.log"))),l.a.createElement("div",{className:"trade-order-log pos-r"},l.a.createElement("dl",{className:"log-title dl-20 f-clear"},l.a.createElement("dd",null,g.a.lang("accountSafe.1_102")),l.a.createElement("dd",null,g.a.lang("Asset.105")),l.a.createElement("dd",null,g.a.lang("tradeHistory.1_9")),l.a.createElement("dd",null,g.a.lang("Billlog.transfer.side")),l.a.createElement("dd",null,g.a.lang("recharge.1_23"))),l.a.createElement("div",{className:"log-contain log-list"},!e&&!e.length&&l.a.createElement("p",{className:"mt-30 tc"},g.a.lang("bank.1_27")),e.hasOwnProperty("Total")&&e.Total>0&&e.List.map(function(e,a){var n=t.getProductName(e.Currency);return l.a.createElement("dl",{className:"dl-20 f-clear",key:a},l.a.createElement("dd",null,e.CreateTime.substring(0,16)),l.a.createElement("dd",null,n),l.a.createElement("dd",null,e.Amount),l.a.createElement("dd",null,8001==e.Action?g.a.lang("Asset.toContract"):8002==e.Action?g.a.lang("Asset.toBit"):"--"),l.a.createElement("dd",null,g.a.lang("EXCHANGE.STATUS."+e.Status)))}),e.hasOwnProperty("PageCount")&&e.PageCount>1&&l.a.createElement(p.a,{className:"pagePos",data:e,onChange:this.turnPage.bind(t),style:{bottom:"-45px"}}))))}}]),t}(o.a)}});