webpackJsonp([30],{104:function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function i(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n.n(r),l=n(25),c=n(7),p=n(196),u=(n.n(p),n(24)),d=n(1),f=n(9),h=n(2),m=n(5),g=n(12),E=n(132),y=n(194),_=n(195),b=n(26),v=n(79),w="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),A=function e(t,n,a){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,a)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(a)},O=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.isDesktop=!1,n.inputsMap={email:{placeholder:function(){return h.a.lang("Login.105")},isRequired:!0,validator:function(e){return E.a.email(e)},newVersion:!0},pwd:{placeholder:function(){return h.a.lang("Login.106")},isRequired:!0,type:"password",newVersion:!0}},n.inputs=Object.keys(n.inputsMap),n.data={},n.inputValid={},n.state={error:"",disable:!1,inputType:!1,errorData:{}},n}return i(t,e),P(t,[{key:"componentDidMount",value:function(){this.props.location&&this.props.location.query&&this.props.location.query.return_to&&(this.turnTo=encodeURIComponent(this.props.location.query.return_to))}},{key:"componentWillUnmount",value:function(){A(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"componentWillUnmount",this).call(this)}},{key:"onChange",value:function(e,t,n){if(this.data[e]=t,this.inputValid[e]!=n){if(this.inputValid[e]=n,!window.IS_LOCAL)return!1;var a=!this.onValidForm();a!=this.state.disable&&this.setState({disable:a})}}},{key:"onValidForm",value:function(){return!(!this.inputValid.email||!this.inputValid.pwd)}},{key:"onInputError",value:function(e,t){var n=this.state.errorData;t?(n[e]="empty"==t?"error."+e+".empty":"error."+e+"."+t,this.setState({errorData:n})):n[e]&&(n[e]="",this.setState({errorData:n}))}},{key:"handleSubmit",value:function(e,t){var n=this;if(!window.IS_LOCAL)return Object(m.g)(h.a.lang("common.not_open"),!0),!1;for(var a in this.inputsMap){if(!this.refs[a].onCheckValid())return!0,this.refs[a].focusInput(),void(t&&t(!1))}var o={UserName:this.data.email,Password:Object(m.f)(this.data.pwd),GeetestChallenge:e.geetest_challenge,GeetestValidate:e.geetest_validate,GeetestSeccode:e.geetest_seccode},i=this,r=this.props.path;f.a.httpRequest("user/login",o,function(e){if(0==e.Status){t&&t(!0);var a=e.Data;if(a.Activated){var o=0==e.Data.Verify.length;g.a.loginedAfter(e,o),o?(g.a.loadAllData(),"object"==("undefined"===typeof ElectronExt?"undefined":w(ElectronExt))&&ElectronExt.showTradeWindow?ElectronExt.showTradeWindow():d.j?c.a.replace("activities/simulatetrade"):g.a.logedRedirect(i.props.location,window.IS_LOCAL&&!n.isDesktop?"/personal":"/trade",c.a.replace)):r?i.popVerify(t):c.a.replace("/verify?datafor=login"+(i.turnTo?"&return_to="+i.turnTo:""))}else a.Email=n.data.email,g.a.registerAfter(e),c.a.replace("/emailVerification")}else t&&t(!1),e.Data?Object(m.g)(Object(m.d)(e.Error,e.Data),!0):e.Error&&Object(m.g)(e.Error,!0)},this)}},{key:"popVerify",value:function(e){var t=this;b.a.open(s.a.createElement(v.default,{path:this.props.path,onChange:function(n){e&&e(!1),t.popCallback(n)},datafor:"login"}),"simple_lang")}},{key:"popCallback",value:function(e){if(b.a.close(),"close"!=e){var t=function(){c.a.replace("/trade")};g.a.loadUserInfo(t)}}},{key:"showPassWord",value:function(e){e.stopPropagation();var t=this.state.inputType;this.inputsMap.pwd.type=t?"password":"text",this.setState({inputType:!t})}},{key:"openNewWin",value:function(e){"object"==("undefined"===typeof ElectronExt?"undefined":w(ElectronExt))&&ElectronExt.openExternal&&ElectronExt.openExternal(""+Object({NODE_ENV:"production",VER_ENV:"web",PUBLIC_URL:"https://res1.tdex.com",REACT_APP_CDN_URL:"https://res2.tdex.com",REACT_APP_CHAT_WS_URL:"wss://realtime2.tdex.com/chat",REACT_APP_ENGINE_DOMAIN:"demo.tdex.com",REACT_APP_HTTP_API_DOMAIN_URL:"/",REACT_APP_HTTP_API_URL:"{origin}/api/v0.1.0/",REACT_APP_SERVER_URL:"{origin}/server/",REACT_APP_SIMULATE_DOMAIN:"sim.tdex.com",REACT_APP_SOCKIO_URL:"",REACT_APP_UPLOAD_URL:"{origin}/api/v0.1.0/",REACT_APP_WS_NEW_URL:"wss://realtime1.tdex.com/realtime",REACT_APP_WS_URL:""}).REACT_APP_URL_ORIGIN+e)}},{key:"changeLanguage",value:function(e){h.a.setLang(e)}},{key:"render",value:function(){var e=this,t=this.state,n=t.errorData,a=t.disable,o=t.inputType;this.props.path;return s.a.createElement("div",{className:"login"},s.a.createElement("div",{className:"login-box"},s.a.createElement("h3",null,h.a.lang("login.welcome")),s.a.createElement("div",{className:"login-input-box"},s.a.createElement("form",null,this.inputs&&this.inputs.map(function(t,a){var i=e.inputsMap[t];return s.a.createElement("div",{className:"login-input-text",key:a},s.a.createElement(_.a,Object.assign({key:a,ref:t,onChange:e.onChange.bind(e,t),onError:e.onInputError.bind(e,t)},i,{ref:t})),"pwd"==t&&s.a.createElement("i",{className:"input-icon iconfont "+(o?"icon-eye-true":"icon-eye-false"),onClick:e.showPassWord.bind(e)}),n[t]&&s.a.createElement("p",{className:"input-error"},s.a.createElement("i",{className:"iconfont icon-tips"}),h.a.lang(n[t])))}),!this.isDesktop&&s.a.createElement("p",{className:"forget-password-text"},window.IS_LOCAL&&s.a.createElement(l.Link,{to:"/forgotPassword"},h.a.lang("login.forget.password"))),this.isDesktop&&s.a.createElement("p",{className:"forget-password-text"},s.a.createElement("a",{href:"javascript:;",onClick:this.openNewWin.bind(this,"/forgotPassword")},h.a.lang("login.forget.password"))),s.a.createElement(y.a,{onSuccess:this.handleSubmit.bind(this),onValidForm:this.onValidForm.bind(this),width:"100%",disable:a,type:"login"},s.a.createElement("button",{type:"submit",className:"active"},h.a.lang("login.login"))),this.isDesktop&&s.a.createElement("div",{className:"langBox pdb-30"},s.a.createElement("span",{className:"lang-cn",onClick:this.changeLanguage.bind(this,"zh-cn")},"\u4e2d\u6587"),s.a.createElement("span",{className:"lang-en",onClick:this.changeLanguage.bind(this,"en-us")},"English"))),!this.isDesktop&&s.a.createElement("div",{className:"login-input-right-text"},s.a.createElement("p",null,h.a.lang("login.tips.1")),s.a.createElement("p",null,h.a.lang("login.tips.2")),s.a.createElement("div",null,h.a.lang("Login.101"),s.a.createElement(l.Link,{className:"text-action",to:"/register"},h.a.lang("Login.102")))))))}}]),t}(u.a);t.default=O}});