webpackJsonp([34],{109:function(e,t,a){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function s(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=a(0),c=a.n(o),l=a(24),i=a(9),u=a(25),h=a(27),d=a(18),m=a(15),f=a(26),g=a(5),p=a(147),v=a(130),E=(a(132),a(2)),y=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),P=function e(t,a,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,a);if(void 0===r){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,a,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)},b=function(e){function t(e){n(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.query=0,a.CoinsMap={},a.fromProducts=[],a.safeBind=!1,a.askTimer=null,a.state={Codes:"",balance:null,FeeNum:0,actNum:0,AskPrice:0,toProducts:[],toCodes:"",showPro:!1,errData:[""],refreshLog:!1,showLog:!1},a}return s(t,e),y(t,[{key:"componentWillUnmount",value:function(){this.closeTimer(),P(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"componentWillUnmount",this).call(this)}},{key:"queryHandle",value:function(){var e=this.props.location.query,t=e.currency;if(this.query==t)return!1;this.query=t}},{key:"componentWillMount",value:function(){this.queryHandle(),this.loadCodesList();var e=d.a.getUserInfo();(e.GgAuth||e.Mobile)&&(this.safeBind=!0)}},{key:"loadCodesList",value:function(){var e=h.a.getProductCoins(),t=this;e?this.saveProducts(e):h.a.loadProductCoins(null,function(e){e&&t.saveProducts(e.List)},this)}},{key:"resetCoinsMap",value:function(e){var t={};e.forEach(function(e){t[e.Id]=e}),this.CoinsMap=t}},{key:"filterCoins",value:function(e){var t=[];for(var a in e)e[a].Exchange&&t.push(e[a]);return t}},{key:"saveProducts",value:function(e){if(this.resetCoinsMap(e),this.fromProducts=this.filterCoins(e),this.fromProducts&&this.fromProducts.length){var t=this.fromProducts[0];this.query?t=this.setProducts(this.query):this.setProducts(t.Id),this.getWalletBalance(t.Id),this.changeProductPrice()}}},{key:"setProducts",value:function(e){var t={},a=[];for(var n in this.fromProducts){if(e==this.fromProducts[n].Id){t=this.fromProducts[n],a=this.saveToProducts(t.Exchange.To);break}}return this.setState({Codes:t,toCodes:a[0],toProducts:a}),t}},{key:"saveToProducts",value:function(e){if(!e||!e.length)return!1;var t=[];for(var a in e){var n=e[a];this.CoinsMap[n]&&t.push(this.CoinsMap[n])}return t}},{key:"setToProducts",value:function(e){var t=this.state.toProducts,a={};for(var n in t){if(e==t[n].Id){a=t[n];break}}return this.setState({toCodes:a}),a}},{key:"getWalletBalance",value:function(e){var t=this;i.a.httpRequest("wallet/balance",{Currency:Number(e)},function(e){if(0==e.Status&&e.Data){var a=e.Data;t.setState({balance:a,showPro:!1})}else t.setState({balance:null})},this)}},{key:"swapProducts",value:function(){var e=this.state.toCodes;e&&(this.resetData(),this.setProducts(e.Id),this.getWalletBalance(e.Id),this.changeProductPrice())}},{key:"changeProductPrice",value:function(){var e=this;setTimeout(function(){e.loadPrice(),e.getExchangePrice()},300)}},{key:"closeTimer",value:function(){this.askTimer&&(clearInterval(this.askTimer),this.askTimer=null)}},{key:"loadPrice",value:function(){var e=this;this.closeTimer(),this.askTimer=setInterval(function(){e.getExchangePrice()},1e3)}},{key:"getExchangePrice",value:function(){var e=this,t=this.state,a=t.Codes,n=t.toCodes,r=a.Id,s=n.Id;if(!r||!s||r==s)return!1;i.a.httpRequest("wallet/exchangePrice",{From:Number(r),To:Number(s)},function(t){if(0==t.Status&&t.Data){var a=t.Data;e.setState({AskPrice:a.Price})}},this)}},{key:"resetData",value:function(){var e={errData:[""],actNum:0};this.refs.tfNum.value="",this.setState(e)}},{key:"changeProduct",value:function(e,t){if(!e||e==this.state.Codes.Id)return!1;"from"==t?(this.setProducts(e),this.getWalletBalance(e)):this.setToProducts(e),this.changeProductPrice(),this.resetData()}},{key:"closeProduct",value:function(e){e.stopPropagation(),this.state.showPro&&this.setState({showPro:!1})}},{key:"resetError",value:function(){this.setState({errData:[""]})}},{key:"checkMoney",value:function(){var e=this.state,t=e.balance,a=e.Codes,n=e.errData,r=0,s="",o=this.walletCounts(t),c=a.Exchange,l=this.refs.tfNum.value,i=Number(l);return l?isNaN(i)?(r=3,s=E.a.lang("Withdrawals.correct_input")):!i||i<c.Min?(r=3,s=E.a.lang("Transfer.error.min",c.Min)):i>c.Max?(r=3,s=E.a.lang("Exchange.error.maxWith")):/^(-?\d+)(\.\d{1,4})?$/.test(i)?o.canUse<i&&(r=3,s=E.a.lang("Withdrawals.error.maxWith")):(r=3,s=E.a.lang("Withdrawals.error.maxFloat",4)):(r=3,s=E.a.lang("form.error.empty")),n[0]=s,this.setState({errData:n}),r}},{key:"checkHadEmpty",value:function(){return!!this.checkMoney()||(this.resetError(),!1)}},{key:"handleSubmit",value:function(e){return e.stopPropagation(),e.preventDefault(),this.safeBind?this.state.Codes?!this.checkHadEmpty()&&void this.popVerify():(Object(g.g)(E.a.lang("common.not_open"),!0),!1):(Object(g.g)(E.a.lang("Withdrawals.119"),!0),!1)}},{key:"popVerify",value:function(){var e=this,t=this.state,a=t.toCodes,n=t.actNum,r=n+" "+a.Code;f.a.open(c.a.createElement(p.a,{title:E.a.lang("Asset.exchange"),content:E.a.lang("Exchange.confirm",r),callback:function(){return e.walletWithdraw()}}),"alert_panel")}},{key:"popCallback",value:function(e){if("close"==e)return void f.a.close();this.walletWithdraw(e)}},{key:"walletWithdraw",value:function(){var e=this.state,t=e.Codes,a=e.toCodes,n=e.refreshLog,r={};r.From=Number(t.Id),r.To=Number(a.Id),r.Amount=Number(this.refs.tfNum.value);var s=this;i.a.httpRequest("wallet/exchange",r,function(e){if(0==e.Status){f.a.close();var t=e.Data;s.setState({balance:t,refreshLog:!n}),Object(g.g)(E.a.lang("Exchange.success"))}},this)}},{key:"setMaxWith",value:function(e,t){t.stopPropagation();var a=this.state.Codes,n=0,r=0,s=e;a.Exchange&&(n=a.Exchange.Max,r=a.Exchange.Min),e>n&&(s=n),e<r&&(s=r),0==e&&(s=0),this.refs.tfNum.value=Number(s),this.setFeeNum()}},{key:"setFeeNum",value:function(){this.state.Codes&&(this.checkMoney()||this.getActual())}},{key:"getActual",value:function(){var e=this.refs.tfNum;if(!e)return!1;var t=this.state,a=t.AskPrice,n=t.Codes,r=Number(e.value),s=0;isNaN(r)||("BTC"==n.Code?s=Number(m.a.accMul(r,a,4)):"USDT"==n.Code&&(s=Number(m.a.accDiv(r,a,4)))),this.setState({actNum:s})}},{key:"walletCounts",value:function(e){var t=0,a=0,n=0;return e&&(a=Number(m.a.accAdd(e.Lock,m.a.accAdd(m.a.accAdd(e.Transfer,e.Deposit),e.Withdraw))),t=Number(m.a.accAdd(a,m.a.accSubtr(e.Quantity,e.Unconfirm))),n=t>0?Number(m.a.accAdd(e.Lock,e.Quantity)):0),{Counts:t,Freeze:a,canUse:n}}},{key:"showLog",value:function(e){this.setState({showLog:e})}},{key:"render",value:function(){var e=this,t=this.state,a=t.AskPrice,n=t.toProducts,r=t.balance,s=t.Codes,o=t.toCodes,l=t.actNum,i=t.FeeNum,h=t.errData,d=t.refreshLog,f=t.showLog,g="0.0000",p="0.0000",v="",y="",P="",b="";if(s&&(v=s.Code,P=s.Exchange.Min,b=s.Exchange.Max),o&&(y=o.Code),r){var C=this.walletCounts(r);g=m.a.format(C.Counts,4).toString(),p=m.a.format(C.canUse,4).toString()}return c.a.createElement("div",{className:"okk-trade-contain",onClick:function(t){return e.closeProduct(t)}},c.a.createElement("div",{className:"contain pdb-50"},c.a.createElement("div",{className:"withdrawal"},c.a.createElement("div",{className:"w-head-top m-head-top",onClick:this.resetData.bind(this)},c.a.createElement("h3",{onClick:function(){return e.showLog(!1)},className:"fl "+(f?"m-under-l":"")},E.a.lang("Asset.exchange")),c.a.createElement("h3",{onClick:function(){return e.showLog(!0)},className:"pc-hide fr "+(f?"":"m-under-l")},E.a.lang("Recharge.log"))),c.a.createElement("div",{className:0==f?"currency_left transfer-box":"currency_left transfer-box m-hide"},c.a.createElement("div",{className:"exchange-info"},c.a.createElement("dl",{className:"wp-33"},c.a.createElement("dt",null,c.a.createElement(k,{products:this.fromProducts,Code:v,dir:"from",onChange:this.changeProduct.bind(this)}))),c.a.createElement("div",{className:"wp-33 md-text"},c.a.createElement("span",{className:"swap-btn",onClick:this.swapProducts.bind(this)},c.a.createElement("i",{className:"iconfont icon-change tb"}))),c.a.createElement("dl",{className:"wp-33"},c.a.createElement("dt",null,c.a.createElement(k,{products:n,dir:"to",Code:y,onChange:this.changeProduct.bind(this)})))),c.a.createElement("form",{className:"Withdrawal_form",onSubmit:function(t){e.handleSubmit(t)},autoComplete:"off"},c.a.createElement("h4",null,E.a.lang("Recharge.note")),c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement("p",null,E.a.lang("Exchange.note1",v,P,b+""+v))),c.a.createElement("li",null,c.a.createElement("p",null,E.a.lang("Exchange.note2")))),c.a.createElement("div",{className:"input_box mt-20"},c.a.createElement("span",{className:"tb"},E.a.lang("Exchange.price"),E.a.lang("common.symbol.colon")),c.a.createElement("span",{className:"c-8"},a)),c.a.createElement("div",{className:"input_box2"},c.a.createElement("div",{className:"f-clear"},c.a.createElement("h5",null,E.a.lang("Exchange.amount"))),c.a.createElement("div",{className:"address f-clear"},c.a.createElement("div",{className:"ipt ipt-box pos-r wp-100 "+(h[0]?"bd-err":"")},c.a.createElement("input",{type:"text",ref:"tfNum",onChange:function(){return e.setFeeNum()},placeholder:E.a.lang("tradeInfo.2_25"),maxLength:"15"}),c.a.createElement("div",{className:"withUse",onClick:function(t){return e.setMaxWith(p,t)}},E.a.lang("Withdrawals.103"),c.a.createElement("span",null,p)))),""!=h[0]&&c.a.createElement("div",{className:"red2 fem75 mt-5"},h[0])),c.a.createElement("div",{className:"input_box3"},c.a.createElement("h5",{className:"trade-order-head-unline c-8 hide"},E.a.lang("Withdrawals.fee"),c.a.createElement("span",null,i)),c.a.createElement("h5",null,E.a.lang("Exchange.getAmount"),c.a.createElement("span",null,l)),c.a.createElement("button",{type:"submit",className:"btn "+(this.safeBind&&g>0?"":"btnDis")},E.a.lang("Exchange.exchange"))),!this.safeBind&&c.a.createElement("dl",{className:"form-box last-form-box f-clear fem75 mt-15"},c.a.createElement("dd",null,c.a.createElement(u.Link,{className:"green4 fs14 cursor warn",to:"/personal"},E.a.lang("Withdrawals.119")))))),c.a.createElement("div",{className:1==!f?"m-hide":"transfer-log-box"},c.a.createElement(N,{coinsMap:this.CoinsMap,refresh:d})))))}}]),t}(l.a);t.default=b;var N=function(e){function t(e){n(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.CoinsMap=null,a.refresh=!1,a.state={curPage:1,historyList:{List:[],PageSize:10}},a}return s(t,e),y(t,[{key:"componentWillMount",value:function(){this.getHistory()}},{key:"getHistory",value:function(e){var t=e||this.state.curPage,a=this;i.a.httpRequest("wallet/exchangeHistory",{Page:t,PageSize:10},function(e){if(0==e.Status){var t=e.Data;a.setState({historyList:t,curPage:t.Page})}},this)}},{key:"componentWillReceiveProps",value:function(e){var t=e.refresh;this.refresh!=t&&(this.refresh=t,this.getHistory()),this.CoinsMap||(this.CoinsMap=e.coinsMap)}},{key:"turnPage",value:function(e){this.getHistory(e)}},{key:"getProductName",value:function(e){if(this.CoinsMap)return this.CoinsMap[e].Code}},{key:"render",value:function(){var e=this.state.historyList,t=this;return c.a.createElement("div",{className:"record_right pos-r"},c.a.createElement("div",{className:"historical"},c.a.createElement("h4",null,E.a.lang("Recharge.log"))),c.a.createElement("div",{className:"trade-order-log pos-r"},c.a.createElement("dl",{className:"log-title dl-16 f-clear"},c.a.createElement("dd",null,E.a.lang("accountSafe.1_102")),c.a.createElement("dd",null,E.a.lang("TradeHistory.103")),c.a.createElement("dd",null,E.a.lang("tradeHistory.1_9")),c.a.createElement("dd",null,E.a.lang("Exchange.actual")),c.a.createElement("dd",null,E.a.lang("Exchange.price")),c.a.createElement("dd",null,E.a.lang("recharge.1_23"))),c.a.createElement("div",{className:"log-contain log-list"},!e&&!e.length&&c.a.createElement("p",{className:"mt-30 tc"},E.a.lang("bank.1_27")),e.hasOwnProperty("Total")&&e.Total>0&&e.List.map(function(e,a){var n=t.getProductName(e.Currency),r=t.getProductName(e.Target);return c.a.createElement("dl",{className:"dl-16 f-clear",key:a},c.a.createElement("dd",null,e.CreateTime.substring(0,16)),c.a.createElement("dd",null,n+"/"+r),c.a.createElement("dd",null,e.Amount),c.a.createElement("dd",null,e.TargetAmount),c.a.createElement("dd",null,e.Price),c.a.createElement("dd",null,E.a.lang("EXCHANGE.STATUS."+e.Status)))}),e.hasOwnProperty("PageCount")&&e.PageCount>1&&c.a.createElement(v.a,{className:"pagePos",data:e,onChange:this.turnPage.bind(t),style:{bottom:"-45px"}}))))}}]),t}(l.a),k=function(e){function t(e){n(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={showPro:!1},a}return s(t,e),y(t,[{key:"toggleProduct",value:function(e){e.stopPropagation(),this.setState({showPro:!this.state.showPro})}},{key:"changeProduct",value:function(e){e&&(this.setState({showPro:!this.state.showPro}),this.props.onChange(e,this.props.dir))}},{key:"render",value:function(){var e=this,t=this.state.showPro,a=this.props,n=a.products,r=a.Code;return c.a.createElement("div",{className:"pos-r"},c.a.createElement("div",{className:"select",onClick:function(t){return e.toggleProduct(t)}},c.a.createElement("div",{className:"currency_text pdl-10"},c.a.createElement("h4",null,r)),c.a.createElement("div",{className:"triangle"},c.a.createElement("i",{className:0==t?"iconfont icon-dropDown c-8":"iconfont icon-dropUp c-8"}))),t&&c.a.createElement("div",{className:"select_option"},c.a.createElement("ul",null,n&&n.map(function(t,a){return c.a.createElement("li",{key:a,onClick:function(){return e.changeProduct(t.Id)}},c.a.createElement("span",{className:"pdl-10 tb"},t.Code))}),!n.length&&c.a.createElement("li",{className:"tc"},c.a.createElement("div",{className:"currency_text c-8"},c.a.createElement("h4",null,E.a.lang("common.not_open")))))))}}]),t}(l.a)}});